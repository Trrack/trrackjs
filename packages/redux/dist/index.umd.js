(function(o,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("@reduxjs/toolkit"),require("@trrack/core")):typeof define=="function"&&define.amd?define(["exports","@reduxjs/toolkit","@trrack/core"],u):(o=typeof globalThis<"u"?globalThis:o||self,u(o.TrrackRTK={},o.RTK,o.Trrack))})(this,function(o,u,P){"use strict";const y=u.createAction("NO_OP"),m=Symbol("label"),O=Symbol("do_undo_action_creators"),b=Symbol("trrackable"),w=Symbol("events"),_=Symbol("action_name_type_map"),k=Symbol("async_thunks");function D(e){const r={};return Object.entries(e.actions).forEach(([n,t])=>{r[n]=t.type}),r}function I(e,r,n){const t={};return n.forEach(s=>{const c=s.typePrefix,a=r[c];if(!a){t[c]=()=>c;return}if(typeof a=="string"){t[c]=()=>a;return}throw typeof a=="function"&&(t[c]=a),new Error(`Error creating label generator for ${c.toString()}`)}),Object.entries(e.actions).forEach(([s,c])=>{const a=r[s];if(!a){t[c.type]=()=>c.type;return}if(typeof a=="string"){t[c.type]=()=>a;return}if(typeof a=="function"){t[c.type]=a;return}throw new Error(`Error creating label generator for ${s.toString()}: ${c.type}`)}),t}function K(e,r,n){const t={};return n.forEach(s=>{const c=s.typePrefix,a=r[c];a?t[c]=a:t[c]=c}),Object.entries(e.actions).forEach(([s,c])=>{const a=r[s];a?t[c.type]=a:t[c.type]=c.type}),t}function B(e,r,n){const t={};return n.forEach(s=>{const c=s.typePrefix,a=r[c];if(a){const l=T=>{const{do:p,undo:f}=a(T);return{do:p||y(),undo:f}};t[c]=l}else{const l=()=>({do:y(),undo:y()});t[c]=l}}),Object.entries(e.actions).forEach(([s,c])=>{const a=r[s];a?t[c.type]=l=>{const{do:T,undo:p}=a(l);return{do:T||y(),undo:p}}:t[c.type]=()=>({do:y(),undo:y()})}),t}function H(e){const r=u.createSlice(e),n=D(r),t=I(r,e.labels||{},e.asyncThunks||[]),s=K(r,e.reducerEventTypes||{},e.asyncThunks||[]),c=B(r,e.doUndoActionCreators||{},e.asyncThunks||[]);return{...r,[m]:t,[w]:s,[O]:c,[b]:!0,[_]:n,[k]:e.asyncThunks||[]}}function S(e){return b?b in e:!1}const Y={current:null},R=u.createSlice({name:"trrack",initialState:Y,reducers:{changeCurrent:(e,r)=>({current:r.payload})}}),{changeCurrent:L}=R.actions;function U(e){return u.configureStore({reducer:R.reducer,preloadedState:e})}const v=u.createAction("traverse",function(r){return{payload:r}});function G(e){return e.type===v.type}function $(e){return function(r,n){return G(n)?e(n.payload,n):e(r,n)}}function q(e){return e.reduce((r,n)=>S(n)?{...r,...n[m]}:r,{})}function z(e){return e.reduce((r,n)=>S(n)?{...r,...n[O]}:r,{})}function F(e){return e.reduce((r,n)=>S(n)?{...r,...n[_]}:r,{})}function V(e){return e.reduce((r,n)=>{if(S(n)){const t={};return n[k].forEach(s=>{t[s.typePrefix]=s,t[s.fulfilled.type]=s}),{...r,...t}}return r},{})}function J(e){return e.reduce((r,n)=>S(n)?[...r,...Object.values(n.actions)]:r,[])}function Q(e){const r=u.createListenerMiddleware(),n=e.reducer,t=u.configureStore({...e,reducer:$(typeof n=="function"?n:u.combineReducers(n)),middleware(i){const d=e.middleware;return d?typeof d=="function"?[...d(i),r.middleware]:[...d,r.middleware]:i().prepend(r.middleware)}}),s=r.startListening,c=q(e.slices),a=z(e.slices),l=F(e.slices),T=V(e.slices),p=J(e.slices),f=P.initializeTrrack({initialState:t.getState(),registry:P.Registry.create()});let E="active";Object.values(T).forEach(i=>{f.registry.has(i.typePrefix)||f.registry.register(i.typePrefix,d=>(E="paused",t.dispatch(i(d)).then(()=>E="active")))}),e.slices.forEach(i=>{Object.values(i.actions).forEach(d=>{f.registry.register(d.type,A=>t.dispatch(A))})});const j=U({current:f.current.id});return f.currentChange(()=>{E="paused",t.dispatch(v(f.getState())),j.dispatch(L(f.current.id)),E="active"}),s({predicate(i){return f.isTraversing||E==="paused"?!1:u.isAsyncThunkAction(i)?u.isFulfilled(i):u.isAnyOf(p[0],...p)(i)},effect(i,d){const A=u.isFulfilled(i),g=A?T[i.type].typePrefix:i.type,Z=i.payload,x=c[g],M=x(Z),h=a[g]({action:i,currentState:d.getState(),previousState:d.getOriginalState()});if(!y.match(h.undo)){const C=h.undo,N=y.match(h.do)?i:h.do;f.record({label:M,state:d.getState(),eventType:l[g],sideEffects:{do:[{type:A?g:N.type,payload:A?N.payload:N}],undo:[{type:C.type,payload:A?C.payload:C}]},onlySideEffects:!0})}else f.record({label:M,state:d.getState(),eventType:l[g],sideEffects:{do:[],undo:[]}})}}),{store:t,trrack:f,trrackStore:j}}function W(e){return Array.isArray(e)}function X(e,r){return u.createAction(e,function(t){return{payload:t}})(r)}o.ACTION_NAME_TYPE_MAP=_,o.ASYNC_THUNKS=k,o.DO_UNDO_ACTION_CREATORS=O,o.EVENTS=w,o.LABELS=m,o.NO_OP_ACTION=y,o.TRRACKABLE=b,o.asyncDoUndoActionCreatorHelper=X,o.changeCurrent=L,o.configureTrrackableStore=Q,o.createTrrackableSlice=H,o.getTrrackStore=U,o.isMiddlewareArray=W,o.isSliceTrrackable=S,o.trrackTraverseAction=v,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=index.umd.js.map
