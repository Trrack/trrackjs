{"version":3,"file":"index.mjs","sources":["../src/slice/types.ts","../src/slice/trrackableSliceCreator.ts","../src/slice/utils.ts","../src/store/trrackStore.ts","../src/store/trrackableStoreCreator.ts","../src/store/utils.ts"],"sourcesContent":["import {\n  ActionCreatorWithPayload,\n  AsyncThunk,\n  CaseReducerActions,\n  createAction,\n  PayloadAction,\n  PayloadActionCreator,\n  Slice,\n  SliceCaseReducers,\n} from '@reduxjs/toolkit';\nimport { Label, LabelGenerator } from '@trrack/core';\n\nexport type LabelLike<CaseReducers extends SliceCaseReducers<any>> = Partial<{\n  [K in keyof CaseReducerActions<CaseReducers, any>]: CaseReducerActions<\n    CaseReducers,\n    any\n  >[K] extends PayloadActionCreator<infer P>\n    ? Label | LabelGenerator<P>\n    : never;\n}>;\n\nexport type LabelGenerators = {\n  [key: string]: LabelGenerator<any>;\n};\n\n/**\n * Events\n */\nexport type ReducerEventTypes<\n  Event extends string,\n  CaseReducers extends SliceCaseReducers<any>\n> = {\n  [K in keyof CaseReducerActions<CaseReducers, any>]: Event;\n};\n\n/**\n * Action Name and Type map\n */\n\nexport type ActionNameToTypeMap<\n  CaseReducers extends SliceCaseReducers<any>,\n  CRA extends CaseReducerActions<CaseReducers, any> = CaseReducerActions<\n    CaseReducers,\n    any\n  >\n> = {\n  [K in keyof CRA]: CRA[K] extends ActionCreatorWithPayload<any, infer T>\n    ? T\n    : never;\n};\n\n/**\n * Do Undo Action Creators\n */\nexport const NO_OP_ACTION = createAction('NO_OP');\n\ntype NoOpActionType = typeof NO_OP_ACTION;\n\ntype DoUndoActionCreator<\n  Payload,\n  DoPayload = Payload,\n  UndoPayload = DoPayload\n> = (args: {\n  action: PayloadAction<Payload>;\n  currentState: any;\n  previousState: any;\n}) => {\n  do?: NoOpActionType | PayloadAction<DoPayload>;\n  undo: NoOpActionType | PayloadAction<UndoPayload>;\n};\n\nexport type DoUndoActionCreators<CaseReducers extends SliceCaseReducers<any>> =\n  Partial<{\n    [key: string]: DoUndoActionCreator<any, any, any>;\n    // [K in keyof CaseReducerActions<CaseReducers>]: CaseReducerActions<CaseReducers>[K] extends PayloadActionCreator<\n    //   infer P\n    // >\n    //   ? DoUndoActionCreator<P, any, any>\n    //   : never;\n  }>;\n\nexport type GeneratedDoUndoActionCreators = {\n  [key: string]: (\n    args: Parameters<DoUndoActionCreator<any, any, any>>[0]\n  ) => Required<ReturnType<DoUndoActionCreator<any, any, any>>>;\n};\n\nexport const LABELS = Symbol('label');\nexport const DO_UNDO_ACTION_CREATORS = Symbol('do_undo_action_creators');\nexport const TRRACKABLE = Symbol('trrackable');\nexport const EVENTS = Symbol('events');\nexport const ACTION_NAME_TYPE_MAP = Symbol('action_name_type_map');\nexport const ASYNC_THUNKS = Symbol('async_thunks');\n\nexport type TrrackableSlice<\n  State,\n  CaseReducers extends SliceCaseReducers<State>,\n  Event extends string = string,\n  Name extends string = string\n> = Slice<State, CaseReducers, Name> & {\n  [LABELS]: LabelGenerators;\n  [EVENTS]: ReducerEventTypes<Event, CaseReducers>;\n  [TRRACKABLE]: boolean;\n  [DO_UNDO_ACTION_CREATORS]: GeneratedDoUndoActionCreators;\n  [ACTION_NAME_TYPE_MAP]: ActionNameToTypeMap<CaseReducers>;\n  [ASYNC_THUNKS]: Array<AsyncThunk<any, any, any>>;\n};\n","import {\n  AsyncThunk,\n  CaseReducerActions,\n  createSlice,\n  CreateSliceOptions,\n  PayloadAction,\n  PayloadActionCreator,\n  Slice,\n  SliceCaseReducers,\n} from '@reduxjs/toolkit';\n\nimport {\n  ACTION_NAME_TYPE_MAP,\n  ActionNameToTypeMap,\n  ASYNC_THUNKS,\n  DO_UNDO_ACTION_CREATORS,\n  DoUndoActionCreators,\n  EVENTS,\n  GeneratedDoUndoActionCreators,\n  LabelGenerators,\n  LabelLike,\n  LABELS,\n  NO_OP_ACTION,\n  ReducerEventTypes,\n  TRRACKABLE,\n  TrrackableSlice,\n} from './types';\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nfunction createNameToTypeMap<\n  CaseReducers extends SliceCaseReducers<any>,\n  S extends Slice<any, CaseReducers, any>\n>(slice: S) {\n  const actionNameToType = {} as ActionNameToTypeMap<CaseReducers>;\n\n  Object.entries(slice.actions).forEach(\n    ([key, action]: [\n      keyof CaseReducerActions<CaseReducers, any>,\n      PayloadActionCreator<any>\n    ]) => {\n      actionNameToType[key] =\n        action.type as ActionNameToTypeMap<CaseReducers>[typeof key];\n    }\n  );\n\n  return actionNameToType;\n}\n\nfunction normalizeLabelGenerators<\n  CaseReducers extends SliceCaseReducers<any>,\n  S extends Slice<any, CaseReducers, any>\n>(\n  slice: S,\n  suppliedLabelLikes: LabelLike<CaseReducers>,\n  thunks: Array<AsyncThunk<any, any, any>>\n): LabelGenerators {\n  const labelGenerators: LabelGenerators = {};\n\n  thunks.forEach((thunk) => {\n    const key = thunk.typePrefix;\n    const suppliedLabelLike = suppliedLabelLikes[key];\n\n    if (!suppliedLabelLike) {\n      labelGenerators[key] = () => key;\n      return;\n    }\n\n    if (typeof suppliedLabelLike === 'string') {\n      labelGenerators[key] = () => suppliedLabelLike;\n      return;\n    }\n\n    if (typeof suppliedLabelLike === 'function') {\n      labelGenerators[key] = suppliedLabelLike;\n    }\n\n    throw new Error(`Error creating label generator for ${key.toString()}`);\n  });\n\n  Object.entries(slice.actions).forEach(\n    ([key, action]: [\n      keyof CaseReducerActions<CaseReducers, any>,\n      PayloadActionCreator<any>\n    ]) => {\n      const suppliedLabelLike = suppliedLabelLikes[key];\n\n      if (!suppliedLabelLike) {\n        labelGenerators[action.type] = () => action.type;\n        return;\n      }\n\n      if (typeof suppliedLabelLike === 'string') {\n        labelGenerators[action.type] = () => suppliedLabelLike;\n        return;\n      }\n\n      if (typeof suppliedLabelLike === 'function') {\n        labelGenerators[action.type] = suppliedLabelLike;\n        return;\n      }\n\n      throw new Error(\n        `Error creating label generator for ${key.toString()}: ${action.type}`\n      );\n    }\n  );\n\n  return labelGenerators;\n}\n\nfunction createReducerEventTypes<\n  Event extends string,\n  CaseReducers extends SliceCaseReducers<any>,\n  S extends Slice<any, CaseReducers, any>\n>(\n  slice: S,\n  suppliedEventTypes: Partial<ReducerEventTypes<Event, CaseReducers>>,\n  thunks: Array<AsyncThunk<any, any, any>>\n): ReducerEventTypes<Event, CaseReducers> {\n  const reducerEventTypes: any = {};\n\n  thunks.forEach((thunk) => {\n    const key = thunk.typePrefix;\n    const suppliedEventType = suppliedEventTypes[key];\n\n    if (!suppliedEventType) {\n      reducerEventTypes[key] = key;\n    } else {\n      reducerEventTypes[key] = suppliedEventType;\n    }\n  });\n\n  Object.entries(slice.actions).forEach(\n    ([key, action]: [\n      keyof CaseReducerActions<CaseReducers, any>,\n      PayloadActionCreator<any>\n    ]) => {\n      const suppliedEventType = suppliedEventTypes[key];\n\n      if (!suppliedEventType) reducerEventTypes[action.type] = action.type;\n      else reducerEventTypes[action.type] = suppliedEventType;\n    }\n  );\n\n  return reducerEventTypes as ReducerEventTypes<Event, CaseReducers>;\n}\n\nfunction createDoUndoActionCreators<\n  State,\n  CaseReducers extends SliceCaseReducers<any>\n>(\n  slice: Slice<State, CaseReducers, any>,\n  suppliedDoUndoActionCreators: DoUndoActionCreators<CaseReducers>,\n  thunks: Array<AsyncThunk<any, any, any>>\n): GeneratedDoUndoActionCreators {\n  const duac: GeneratedDoUndoActionCreators = {};\n\n  thunks.forEach((thunk) => {\n    const key = thunk.typePrefix;\n\n    const suppliedDoUndoActionCreator = suppliedDoUndoActionCreators[key];\n\n    if (!suppliedDoUndoActionCreator) {\n      const act = () => {\n        return {\n          do: NO_OP_ACTION(),\n          undo: NO_OP_ACTION(),\n        };\n      };\n      duac[key] = act;\n    } else {\n      const act = (args: {\n        action: PayloadAction;\n        previousState: State;\n        currentState: State;\n      }) => {\n        const { do: doAct, undo } = suppliedDoUndoActionCreator(args);\n\n        return {\n          do: doAct ? doAct : NO_OP_ACTION(),\n          undo,\n        };\n      };\n\n      duac[key] = act;\n    }\n  });\n\n  Object.entries(slice.actions).forEach(\n    <K extends keyof CaseReducerActions<CaseReducers, any>>([key, action]: [\n      K,\n      Exclude<CaseReducerActions<CaseReducers, any>[K], void>\n    ]) => {\n      const suppliedDoUndoActionCreator =\n        suppliedDoUndoActionCreators[key as string];\n      if (!suppliedDoUndoActionCreator) {\n        duac[action.type] = () => {\n          return {\n            do: NO_OP_ACTION(),\n            undo: NO_OP_ACTION(),\n          };\n        };\n      } else {\n        duac[action.type] = (args: {\n          action: PayloadAction;\n          previousState: State;\n          currentState: State;\n        }) => {\n          const { do: doAct, undo } = suppliedDoUndoActionCreator(args);\n\n          return {\n            do: doAct ? doAct : NO_OP_ACTION(),\n            undo,\n          };\n        };\n      }\n    }\n  );\n\n  return duac;\n}\n\nexport function createTrrackableSlice<\n  State,\n  CaseReducers extends SliceCaseReducers<State>,\n  Event extends string = string,\n  Name extends string = string\n>(\n  options: CreateSliceOptions<State, CaseReducers, Name> & {\n    labels?: LabelLike<CaseReducers>;\n    reducerEventTypes?: Partial<ReducerEventTypes<Event, CaseReducers>>;\n    doUndoActionCreators?: DoUndoActionCreators<CaseReducers>;\n    asyncThunks?: Array<AsyncThunk<any, any, any>>;\n  }\n): TrrackableSlice<State, CaseReducers, Event, Name> {\n  const slice = createSlice(options);\n\n  const actionNameToType: ActionNameToTypeMap<CaseReducers> =\n    createNameToTypeMap(slice);\n\n  const labels = normalizeLabelGenerators(\n    slice,\n    options.labels || {},\n    options.asyncThunks || []\n  );\n\n  const reducerEventTypes = createReducerEventTypes(\n    slice,\n    options.reducerEventTypes || {},\n    options.asyncThunks || []\n  );\n\n  const doUndoActioncreators = createDoUndoActionCreators(\n    slice,\n    options.doUndoActionCreators || {},\n    options.asyncThunks || []\n  );\n\n  return {\n    ...slice,\n    [LABELS]: labels,\n    [EVENTS]: reducerEventTypes,\n    [DO_UNDO_ACTION_CREATORS]: doUndoActioncreators,\n    [TRRACKABLE]: true,\n    [ACTION_NAME_TYPE_MAP]: actionNameToType,\n    [ASYNC_THUNKS]: options.asyncThunks || [],\n  };\n}\n","import { Slice } from '@reduxjs/toolkit';\n\nimport { TRRACKABLE, TrrackableSlice } from './types';\n\nexport function isSliceTrrackable(\n  slice: Slice\n): slice is TrrackableSlice<any, any> {\n  return TRRACKABLE ? TRRACKABLE in slice : false;\n}\n","import { configureStore, createSlice, PayloadAction } from '@reduxjs/toolkit';\nimport { NodeId } from '@trrack/core';\n\ntype TrrackSliceState = {\n  current: NodeId;\n};\n\nconst initialState: TrrackSliceState = {\n  current: null as any,\n};\n\nconst trrackSlice = createSlice({\n  name: 'trrack',\n  initialState,\n  reducers: {\n    changeCurrent: (_, action: PayloadAction<NodeId>) => ({\n      current: action.payload,\n    }),\n  },\n});\n\nexport const { changeCurrent } = trrackSlice.actions;\n\nexport function getTrrackStore(init: TrrackSliceState) {\n  return configureStore({\n    reducer: trrackSlice.reducer,\n    preloadedState: init as any,\n  });\n}\n\ntype TrrackStore = ReturnType<typeof getTrrackStore>;\n\nexport type TrrackStoreType = ReturnType<TrrackStore['getState']>;\n","/* eslint-disable @typescript-eslint/no-explicit-any */\nimport {\n  Action,\n  AnyAction,\n  AsyncThunk,\n  combineReducers,\n  configureStore,\n  ConfigureStoreOptions,\n  createAction,\n  createListenerMiddleware,\n  isAnyOf,\n  isAsyncThunkAction,\n  isFulfilled,\n  PayloadAction,\n  PayloadActionCreator,\n  Reducer,\n  Slice,\n  SliceCaseReducers,\n  TypedStartListening,\n} from '@reduxjs/toolkit';\nimport { initializeTrrack, Registry } from '@trrack/core';\n\nimport { isSliceTrrackable } from '../slice';\nimport {\n  ACTION_NAME_TYPE_MAP,\n  ASYNC_THUNKS,\n  DO_UNDO_ACTION_CREATORS,\n  GeneratedDoUndoActionCreators,\n  LabelGenerators,\n  LABELS,\n  NO_OP_ACTION,\n} from '../slice/types';\nimport { changeCurrent, getTrrackStore } from './trrackStore';\n\n// Fin.\n\nexport const trrackTraverseAction = createAction('traverse', function prepare<\n  T\n>(state: T) {\n  return {\n    payload: state,\n  };\n});\n\nfunction isTraverseAction(\n  action: AnyAction\n): action is ReturnType<typeof trrackTraverseAction> {\n  return action.type === trrackTraverseAction.type;\n}\n\nfunction makeTrrackable<State, A extends Action = AnyAction>(\n  reducer: Reducer<State, A>\n) {\n  return function (state: State | undefined, action: A) {\n    if (isTraverseAction(action))\n      return reducer(action.payload as State, action);\n    return reducer(state, action);\n  };\n}\n\nfunction mergeLabels(slices: Slice[]) {\n  return slices.reduce((acc, slice) => {\n    if (isSliceTrrackable(slice)) {\n      return { ...acc, ...slice[LABELS] };\n    }\n    return acc;\n  }, {} as LabelGenerators);\n}\n\nfunction mergeDoUndoActionCreators(slices: Slice[]) {\n  return slices.reduce((acc, slice) => {\n    if (isSliceTrrackable(slice)) {\n      return { ...acc, ...slice[DO_UNDO_ACTION_CREATORS] };\n    }\n    return acc;\n  }, {} as GeneratedDoUndoActionCreators);\n}\n\nfunction mergeReducerEventTypes(slices: Slice[]) {\n  return slices.reduce((acc, slice) => {\n    if (isSliceTrrackable(slice)) {\n      return { ...acc, ...slice[ACTION_NAME_TYPE_MAP] };\n    }\n    return acc;\n  }, {} as { [key: string]: string });\n}\n\nfunction mergeAsyncThunks(slices: Slice[]) {\n  return slices.reduce((acc, slice) => {\n    if (isSliceTrrackable(slice)) {\n      const asyncs: { [key: string]: AsyncThunk<any, any, any> } = {};\n\n      slice[ASYNC_THUNKS].forEach((thunk) => {\n        asyncs[thunk.typePrefix] = thunk;\n        asyncs[thunk.fulfilled.type] = thunk;\n      });\n\n      return { ...acc, ...asyncs };\n    }\n    return acc;\n  }, {} as { [key: string]: AsyncThunk<any, any, any> });\n}\n\nfunction mergeTrrackedActions(slices: Slice[]) {\n  return slices.reduce((acc, slice) => {\n    if (isSliceTrrackable(slice)) {\n      return [\n        ...acc,\n        ...(Object.values(slice.actions) as Array<PayloadActionCreator>),\n      ];\n    }\n    return acc;\n  }, [] as Array<PayloadActionCreator>);\n}\n\nfunction mergeReducers(slices: Slice[]) {\n  return slices.reduce((acc, slice) => {\n    const scr: SliceCaseReducers<any> = {};\n\n    Object.entries(slice.actions).forEach(([key, action]) => {\n      scr[action.type] = slice.caseReducers[key];\n    });\n\n    return { ...acc, ...scr };\n  }, {} as SliceCaseReducers<any>);\n}\n\nfunction mergeActionToSliceName(slices: Slice[]) {\n  return slices.reduce((acc, slice) => {\n    const scr: { [key: string]: string } = {};\n\n    Object.values(slice.actions).forEach((action) => {\n      scr[action.type] = slice.name;\n    });\n\n    return { ...acc, ...scr };\n  }, {} as { [key: string]: string });\n}\n\nexport function configureTrrackableStore<State>(\n  opts: ConfigureStoreOptions<State, AnyAction> & {\n    slices: Slice[];\n  }\n) {\n  const trrackMiddleware = createListenerMiddleware();\n\n  const _reducer = opts.reducer;\n\n  const store = configureStore({\n    ...opts,\n    reducer: makeTrrackable(\n      typeof _reducer === 'function'\n        ? _reducer\n        : (combineReducers(_reducer) as any)\n    ),\n    middleware(getDefaultMiddleware) {\n      const suppliedMiddleware = opts.middleware;\n      if (!suppliedMiddleware)\n        return getDefaultMiddleware().prepend(trrackMiddleware.middleware);\n      if (typeof suppliedMiddleware === 'function') {\n        return [\n          ...suppliedMiddleware(getDefaultMiddleware),\n          trrackMiddleware.middleware,\n        ];\n      }\n      return [...suppliedMiddleware, trrackMiddleware.middleware];\n    },\n  });\n\n  /**\n   * Create types for listener\n   */\n  type RootState = ReturnType<typeof store.getState>;\n  type AppDispatch = typeof store.dispatch;\n\n  type AppStartListening = TypedStartListening<RootState, AppDispatch>;\n  const startListening = trrackMiddleware.startListening as AppStartListening;\n  // Fin.\n\n  const labels = mergeLabels(opts.slices);\n  const doUndoActionCreators = mergeDoUndoActionCreators(opts.slices);\n  const reducerEventTypes = mergeReducerEventTypes(opts.slices);\n  const asyncThunks = mergeAsyncThunks(opts.slices);\n  const trrackedActions = mergeTrrackedActions(opts.slices);\n\n  const trrack = initializeTrrack({\n    initialState: store.getState(),\n    registry: Registry.create(),\n  });\n\n  let middlewareStatus: 'active' | 'paused' = 'active';\n\n  Object.values(asyncThunks).forEach((thunk) => {\n    if (!trrack.registry.has(thunk.typePrefix)) {\n      trrack.registry.register(thunk.typePrefix, (args: any) => {\n        middlewareStatus = 'paused';\n        const th = store.dispatch(thunk(args) as any);\n        return th.then(() => (middlewareStatus = 'active'));\n      });\n    }\n  });\n\n  opts.slices.forEach((slice) => {\n    Object.values(slice.actions).forEach((action) => {\n      trrack.registry.register(action.type, ((act: AnyAction) => {\n        return store.dispatch(act);\n      }) as any);\n    });\n  });\n\n  const trrackStore = getTrrackStore({\n    current: trrack.current.id,\n  });\n\n  trrack.currentChange(() => {\n    middlewareStatus = 'paused';\n    store.dispatch(trrackTraverseAction(trrack.getState()));\n    trrackStore.dispatch(changeCurrent(trrack.current.id));\n    middlewareStatus = 'active';\n  });\n\n  startListening({\n    predicate(action) {\n      if (trrack.isTraversing) return false; // Never run middleware when trrack is traversing.\n\n      if (middlewareStatus === 'paused') return false; // Never run middleware when middleware is set to pause.\n\n      // Check if given actions is fulfilled async thunk action and only then return true.\n      if (isAsyncThunkAction(action)) {\n        return isFulfilled(action);\n      }\n\n      // Run the middleware if the action is trracked, trrack is not traversing and middleware is not paused.\n      const isTrrackedAction = isAnyOf(trrackedActions[0], ...trrackedActions);\n      return isTrrackedAction(action);\n    },\n    effect(action, api) {\n      const isThunk = isFulfilled(action);\n\n      const type = isThunk ? asyncThunks[action.type].typePrefix : action.type;\n      const payload = action['payload'];\n      const labelGenerator = labels[type];\n\n      const label = labelGenerator(payload);\n\n      const doUndoObject = doUndoActionCreators[type]({\n        action: action as PayloadAction,\n        currentState: api.getState(),\n        previousState: api.getOriginalState(),\n      });\n\n      const hasSideEffects = !NO_OP_ACTION.match(doUndoObject.undo);\n\n      if (hasSideEffects) {\n        const undoAct = doUndoObject.undo as PayloadAction;\n        const doAct = NO_OP_ACTION.match(doUndoObject.do)\n          ? (action as PayloadAction)\n          : (doUndoObject.do as PayloadAction);\n\n        trrack.record({\n          label,\n          state: api.getState(),\n          eventType: reducerEventTypes[type],\n          sideEffects: {\n            do: [\n              {\n                type: isThunk ? type : doAct.type,\n                payload: isThunk ? doAct.payload : doAct,\n              },\n            ],\n            undo: [\n              {\n                type: undoAct.type,\n                payload: isThunk ? undoAct.payload : undoAct,\n              },\n            ],\n          },\n          onlySideEffects: true,\n        });\n      } else {\n        // ! Fix\n\n        trrack.record({\n          label,\n          state: api.getState(),\n          eventType: reducerEventTypes[type],\n          sideEffects: {\n            do: [],\n            undo: [],\n          },\n        });\n      }\n    },\n  });\n\n  return { store, trrack, trrackStore };\n}\n","import { createAction } from '@reduxjs/toolkit';\n\nimport { Middlewares, PossibleMiddleware } from './types';\n\nexport function isMiddlewareArray<State>(\n  middleware: PossibleMiddleware<State>\n): middleware is Middlewares<State> {\n  return Array.isArray(middleware);\n}\n\nexport function asyncDoUndoActionCreatorHelper<T>(type: string, payload: T) {\n  return createAction(type, function prepare(c: T) {\n    return {\n      payload: c,\n    };\n  })(payload);\n}\n"],"names":["NO_OP_ACTION","createAction","LABELS","DO_UNDO_ACTION_CREATORS","TRRACKABLE","EVENTS","ACTION_NAME_TYPE_MAP","ASYNC_THUNKS","createNameToTypeMap","slice","actionNameToType","key","action","normalizeLabelGenerators","suppliedLabelLikes","thunks","labelGenerators","thunk","suppliedLabelLike","createReducerEventTypes","suppliedEventTypes","reducerEventTypes","suppliedEventType","createDoUndoActionCreators","suppliedDoUndoActionCreators","duac","suppliedDoUndoActionCreator","act","args","doAct","undo","createTrrackableSlice","options","createSlice","labels","doUndoActioncreators","isSliceTrrackable","initialState","trrackSlice","_","changeCurrent","getTrrackStore","init","configureStore","trrackTraverseAction","state","isTraverseAction","makeTrrackable","reducer","mergeLabels","slices","acc","mergeDoUndoActionCreators","mergeReducerEventTypes","mergeAsyncThunks","asyncs","mergeTrrackedActions","configureTrrackableStore","opts","trrackMiddleware","createListenerMiddleware","_reducer","store","combineReducers","getDefaultMiddleware","suppliedMiddleware","startListening","doUndoActionCreators","asyncThunks","trrackedActions","trrack","initializeTrrack","Registry","middlewareStatus","trrackStore","isAsyncThunkAction","isFulfilled","isAnyOf","api","isThunk","type","payload","labelGenerator","label","doUndoObject","undoAct","isMiddlewareArray","middleware","asyncDoUndoActionCreatorHelper","c"],"mappings":";;AAsDa,MAAAA,IAAeC,EAAa,OAAO,GAiCnCC,IAAS,OAAO,OAAO,GACvBC,IAA0B,OAAO,yBAAyB,GAC1DC,IAAa,OAAO,YAAY,GAChCC,IAAS,OAAO,QAAQ,GACxBC,IAAuB,OAAO,sBAAsB,GACpDC,IAAe,OAAO,cAAc;AC/DjD,SAASC,EAGPC,GAAU;AACV,QAAMC,IAAmB,CAAA;AAElB,gBAAA,QAAQD,EAAM,OAAO,EAAE;AAAA,IAC5B,CAAC,CAACE,GAAKC,CAAM,MAGP;AACa,MAAAF,EAAAC,CAAG,IAClBC,EAAO;AAAA,IACX;AAAA,EAAA,GAGKF;AACT;AAEA,SAASG,EAIPJ,GACAK,GACAC,GACiB;AACjB,QAAMC,IAAmC,CAAA;AAElC,SAAAD,EAAA,QAAQ,CAACE,MAAU;AACxB,UAAMN,IAAMM,EAAM,YACZC,IAAoBJ,EAAmBH,CAAG;AAEhD,QAAI,CAACO,GAAmB;AACN,MAAAF,EAAAL,CAAG,IAAI,MAAMA;AAC7B;AAAA,IACF;AAEI,QAAA,OAAOO,KAAsB,UAAU;AACzB,MAAAF,EAAAL,CAAG,IAAI,MAAMO;AAC7B;AAAA,IACF;AAEI,UAAA,OAAOA,KAAsB,eAC/BF,EAAgBL,CAAG,IAAIO,IAGnB,IAAI,MAAM,sCAAsCP,EAAI,SAAA,CAAU,EAAE;AAAA,EAAA,CACvE,GAEM,OAAA,QAAQF,EAAM,OAAO,EAAE;AAAA,IAC5B,CAAC,CAACE,GAAKC,CAAM,MAGP;AACE,YAAAM,IAAoBJ,EAAmBH,CAAG;AAEhD,UAAI,CAACO,GAAmB;AACtB,QAAAF,EAAgBJ,EAAO,IAAI,IAAI,MAAMA,EAAO;AAC5C;AAAA,MACF;AAEI,UAAA,OAAOM,KAAsB,UAAU;AACzB,QAAAF,EAAAJ,EAAO,IAAI,IAAI,MAAMM;AACrC;AAAA,MACF;AAEI,UAAA,OAAOA,KAAsB,YAAY;AAC3B,QAAAF,EAAAJ,EAAO,IAAI,IAAIM;AAC/B;AAAA,MACF;AAEA,YAAM,IAAI;AAAA,QACR,sCAAsCP,EAAI,SAAA,CAAU,KAAKC,EAAO,IAAI;AAAA,MAAA;AAAA,IAExE;AAAA,EAAA,GAGKI;AACT;AAEA,SAASG,EAKPV,GACAW,GACAL,GACwC;AACxC,QAAMM,IAAyB,CAAA;AAExB,SAAAN,EAAA,QAAQ,CAACE,MAAU;AACxB,UAAMN,IAAMM,EAAM,YACZK,IAAoBF,EAAmBT,CAAG;AAEhD,IAAKW,IAGHD,EAAkBV,CAAG,IAAIW,IAFzBD,EAAkBV,CAAG,IAAIA;AAAA,EAG3B,CACD,GAEM,OAAA,QAAQF,EAAM,OAAO,EAAE;AAAA,IAC5B,CAAC,CAACE,GAAKC,CAAM,MAGP;AACE,YAAAU,IAAoBF,EAAmBT,CAAG;AAEhD,MAAKW,IACkBD,EAAAT,EAAO,IAAI,IAAIU,IADID,EAAAT,EAAO,IAAI,IAAIA,EAAO;AAAA,IAElE;AAAA,EAAA,GAGKS;AACT;AAEA,SAASE,EAIPd,GACAe,GACAT,GAC+B;AAC/B,QAAMU,IAAsC,CAAA;AAErC,SAAAV,EAAA,QAAQ,CAACE,MAAU;AACxB,UAAMN,IAAMM,EAAM,YAEZS,IAA8BF,EAA6Bb,CAAG;AAEpE,QAAKe,GAQE;AACC,YAAAC,IAAM,CAACC,MAIP;AACJ,cAAM,EAAE,IAAIC,GAAO,MAAAC,EAAK,IAAIJ,EAA4BE,CAAI;AAErD,eAAA;AAAA,UACL,IAAIC,KAAgB7B,EAAa;AAAA,UACjC,MAAA8B;AAAA,QAAA;AAAA,MACF;AAGF,MAAAL,EAAKd,CAAG,IAAIgB;AAAA,IACd,OAvBkC;AAChC,YAAMA,IAAM,OACH;AAAA,QACL,IAAI3B,EAAa;AAAA,QACjB,MAAMA,EAAa;AAAA,MAAA;AAGvB,MAAAyB,EAAKd,CAAG,IAAIgB;AAAA,IAAA;AAAA,EAgBd,CACD,GAEM,OAAA,QAAQlB,EAAM,OAAO,EAAE;AAAA,IAC5B,CAAwD,CAACE,GAAKC,CAAM,MAG9D;AACE,YAAAc,IACJF,EAA6Bb,CAAa;AAC5C,MAAKe,IAQHD,EAAKb,EAAO,IAAI,IAAI,CAACgB,MAIf;AACJ,cAAM,EAAE,IAAIC,GAAO,MAAAC,EAAK,IAAIJ,EAA4BE,CAAI;AAErD,eAAA;AAAA,UACL,IAAIC,KAAgB7B,EAAa;AAAA,UACjC,MAAA8B;AAAA,QAAA;AAAA,MACF,IAjBGL,EAAAb,EAAO,IAAI,IAAI,OACX;AAAA,QACL,IAAIZ,EAAa;AAAA,QACjB,MAAMA,EAAa;AAAA,MAAA;AAAA,IAiB3B;AAAA,EAAA,GAGKyB;AACT;AAEO,SAASM,GAMdC,GAMmD;AAC7C,QAAAvB,IAAQwB,EAAYD,CAAO,GAE3BtB,IACJF,EAAoBC,CAAK,GAErByB,IAASrB;AAAA,IACbJ;AAAA,IACAuB,EAAQ,UAAU,CAAC;AAAA,IACnBA,EAAQ,eAAe,CAAC;AAAA,EAAA,GAGpBX,IAAoBF;AAAA,IACxBV;AAAA,IACAuB,EAAQ,qBAAqB,CAAC;AAAA,IAC9BA,EAAQ,eAAe,CAAC;AAAA,EAAA,GAGpBG,IAAuBZ;AAAA,IAC3Bd;AAAA,IACAuB,EAAQ,wBAAwB,CAAC;AAAA,IACjCA,EAAQ,eAAe,CAAC;AAAA,EAAA;AAGnB,SAAA;AAAA,IACL,GAAGvB;AAAA,IACH,CAACP,CAAM,GAAGgC;AAAA,IACV,CAAC7B,CAAM,GAAGgB;AAAA,IACV,CAAClB,CAAuB,GAAGgC;AAAA,IAC3B,CAAC/B,CAAU,GAAG;AAAA,IACd,CAACE,CAAoB,GAAGI;AAAA,IACxB,CAACH,CAAY,GAAGyB,EAAQ,eAAe,CAAC;AAAA,EAAA;AAE5C;ACvQO,SAASI,EACd3B,GACoC;AAC7B,SAAAL,IAAaA,KAAcK,IAAQ;AAC5C;ACDA,MAAM4B,IAAiC;AAAA,EACrC,SAAS;AACX,GAEMC,IAAcL,EAAY;AAAA,EAC9B,MAAM;AAAA,EACN,cAAAI;AAAA,EACA,UAAU;AAAA,IACR,eAAe,CAACE,GAAG3B,OAAmC;AAAA,MACpD,SAASA,EAAO;AAAA,IAAA;AAAA,EAEpB;AACF,CAAC,GAEY,EAAE,eAAA4B,EAAc,IAAIF,EAAY;AAEtC,SAASG,EAAeC,GAAwB;AACrD,SAAOC,EAAe;AAAA,IACpB,SAASL,EAAY;AAAA,IACrB,gBAAgBI;AAAA,EAAA,CACjB;AACH;ACQO,MAAME,IAAuB3C,EAAa,YAAY,SAE3D4C,GAAU;AACH,SAAA;AAAA,IACL,SAASA;AAAA,EAAA;AAEb,CAAC;AAED,SAASC,EACPlC,GACmD;AAC5C,SAAAA,EAAO,SAASgC,EAAqB;AAC9C;AAEA,SAASG,EACPC,GACA;AACO,SAAA,SAAUH,GAA0BjC,GAAW;AACpD,WAAIkC,EAAiBlC,CAAM,IAClBoC,EAAQpC,EAAO,SAAkBA,CAAM,IACzCoC,EAAQH,GAAOjC,CAAM;AAAA,EAAA;AAEhC;AAEA,SAASqC,EAAYC,GAAiB;AACpC,SAAOA,EAAO,OAAO,CAACC,GAAK1C,MACrB2B,EAAkB3B,CAAK,IAClB,EAAE,GAAG0C,GAAK,GAAG1C,EAAMP,CAAM,EAAE,IAE7BiD,GACN,CAAqB,CAAA;AAC1B;AAEA,SAASC,EAA0BF,GAAiB;AAClD,SAAOA,EAAO,OAAO,CAACC,GAAK1C,MACrB2B,EAAkB3B,CAAK,IAClB,EAAE,GAAG0C,GAAK,GAAG1C,EAAMN,CAAuB,EAAE,IAE9CgD,GACN,CAAmC,CAAA;AACxC;AAEA,SAASE,GAAuBH,GAAiB;AAC/C,SAAOA,EAAO,OAAO,CAACC,GAAK1C,MACrB2B,EAAkB3B,CAAK,IAClB,EAAE,GAAG0C,GAAK,GAAG1C,EAAMH,CAAoB,EAAE,IAE3C6C,GACN,CAA+B,CAAA;AACpC;AAEA,SAASG,GAAiBJ,GAAiB;AACzC,SAAOA,EAAO,OAAO,CAACC,GAAK1C,MAAU;AAC/B,QAAA2B,EAAkB3B,CAAK,GAAG;AAC5B,YAAM8C,IAAuD,CAAA;AAE7D,aAAA9C,EAAMF,CAAY,EAAE,QAAQ,CAACU,MAAU;AAC9B,QAAAsC,EAAAtC,EAAM,UAAU,IAAIA,GACpBsC,EAAAtC,EAAM,UAAU,IAAI,IAAIA;AAAA,MAAA,CAChC,GAEM,EAAE,GAAGkC,GAAK,GAAGI;IACtB;AACO,WAAAJ;AAAA,EACT,GAAG,CAAkD,CAAA;AACvD;AAEA,SAASK,GAAqBN,GAAiB;AAC7C,SAAOA,EAAO,OAAO,CAACC,GAAK1C,MACrB2B,EAAkB3B,CAAK,IAClB;AAAA,IACL,GAAG0C;AAAA,IACH,GAAI,OAAO,OAAO1C,EAAM,OAAO;AAAA,EAAA,IAG5B0C,GACN,CAAiC,CAAA;AACtC;AA0BO,SAASM,GACdC,GAGA;AACA,QAAMC,IAAmBC,KAEnBC,IAAWH,EAAK,SAEhBI,IAAQnB,EAAe;AAAA,IAC3B,GAAGe;AAAA,IACH,SAASX;AAAA,MACP,OAAOc,KAAa,aAChBA,IACCE,EAAgBF,CAAQ;AAAA,IAC/B;AAAA,IACA,WAAWG,GAAsB;AAC/B,YAAMC,IAAqBP,EAAK;AAChC,aAAKO,IAED,OAAOA,KAAuB,aACzB;AAAA,QACL,GAAGA,EAAmBD,CAAoB;AAAA,QAC1CL,EAAiB;AAAA,MAAA,IAGd,CAAC,GAAGM,GAAoBN,EAAiB,UAAU,IAPjDK,EAAqB,EAAE,QAAQL,EAAiB,UAAU;AAAA,IAQrE;AAAA,EAAA,CACD,GASKO,IAAiBP,EAAiB,gBAGlCzB,IAASe,EAAYS,EAAK,MAAM,GAChCS,IAAuBf,EAA0BM,EAAK,MAAM,GAC5DrC,IAAoBgC,GAAuBK,EAAK,MAAM,GACtDU,IAAcd,GAAiBI,EAAK,MAAM,GAC1CW,IAAkBb,GAAqBE,EAAK,MAAM,GAElDY,IAASC,EAAiB;AAAA,IAC9B,cAAcT,EAAM,SAAS;AAAA,IAC7B,UAAUU,EAAS,OAAO;AAAA,EAAA,CAC3B;AAED,MAAIC,IAAwC;AAE5C,SAAO,OAAOL,CAAW,EAAE,QAAQ,CAACnD,MAAU;AAC5C,IAAKqD,EAAO,SAAS,IAAIrD,EAAM,UAAU,KACvCqD,EAAO,SAAS,SAASrD,EAAM,YAAY,CAACW,OACvB6C,IAAA,UACRX,EAAM,SAAS7C,EAAMW,CAAI,CAAQ,EAClC,KAAK,MAAO6C,IAAmB,QAAS,EACnD;AAAA,EACH,CACD,GAEIf,EAAA,OAAO,QAAQ,CAACjD,MAAU;AAC7B,WAAO,OAAOA,EAAM,OAAO,EAAE,QAAQ,CAACG,MAAW;AAC/C,MAAA0D,EAAO,SAAS,SAAS1D,EAAO,MAAO,CAACe,MAC/BmC,EAAM,SAASnC,CAAG,CAClB;AAAA,IAAA,CACV;AAAA,EAAA,CACF;AAED,QAAM+C,IAAcjC,EAAe;AAAA,IACjC,SAAS6B,EAAO,QAAQ;AAAA,EAAA,CACzB;AAED,SAAAA,EAAO,cAAc,MAAM;AACN,IAAAG,IAAA,UACnBX,EAAM,SAASlB,EAAqB0B,EAAO,SAAA,CAAU,CAAC,GACtDI,EAAY,SAASlC,EAAc8B,EAAO,QAAQ,EAAE,CAAC,GAClCG,IAAA;AAAA,EAAA,CACpB,GAEcP,EAAA;AAAA,IACb,UAAUtD,GAAQ;AAGhB,aAFI0D,EAAO,gBAEPG,MAAqB,WAAiB,KAGtCE,EAAmB/D,CAAM,IACpBgE,EAAYhE,CAAM,IAIFiE,EAAQR,EAAgB,CAAC,GAAG,GAAGA,CAAe,EAC/CzD,CAAM;AAAA,IAChC;AAAA,IACA,OAAOA,GAAQkE,GAAK;AACZ,YAAAC,IAAUH,EAAYhE,CAAM,GAE5BoE,IAAOD,IAAUX,EAAYxD,EAAO,IAAI,EAAE,aAAaA,EAAO,MAC9DqE,IAAUrE,EAAO,SACjBsE,IAAiBhD,EAAO8C,CAAI,GAE5BG,IAAQD,EAAeD,CAAO,GAE9BG,IAAejB,EAAqBa,CAAI,EAAE;AAAA,QAC9C,QAAApE;AAAA,QACA,cAAckE,EAAI,SAAS;AAAA,QAC3B,eAAeA,EAAI,iBAAiB;AAAA,MAAA,CACrC;AAID,UAFuB,CAAC9E,EAAa,MAAMoF,EAAa,IAAI,GAExC;AAClB,cAAMC,IAAUD,EAAa,MACvBvD,IAAQ7B,EAAa,MAAMoF,EAAa,EAAE,IAC3CxE,IACAwE,EAAa;AAElB,QAAAd,EAAO,OAAO;AAAA,UACZ,OAAAa;AAAA,UACA,OAAOL,EAAI,SAAS;AAAA,UACpB,WAAWzD,EAAkB2D,CAAI;AAAA,UACjC,aAAa;AAAA,YACX,IAAI;AAAA,cACF;AAAA,gBACE,MAAMD,IAAUC,IAAOnD,EAAM;AAAA,gBAC7B,SAASkD,IAAUlD,EAAM,UAAUA;AAAA,cACrC;AAAA,YACF;AAAA,YACA,MAAM;AAAA,cACJ;AAAA,gBACE,MAAMwD,EAAQ;AAAA,gBACd,SAASN,IAAUM,EAAQ,UAAUA;AAAA,cACvC;AAAA,YACF;AAAA,UACF;AAAA,UACA,iBAAiB;AAAA,QAAA,CAClB;AAAA,MAAA;AAID,QAAAf,EAAO,OAAO;AAAA,UACZ,OAAAa;AAAA,UACA,OAAOL,EAAI,SAAS;AAAA,UACpB,WAAWzD,EAAkB2D,CAAI;AAAA,UACjC,aAAa;AAAA,YACX,IAAI,CAAC;AAAA,YACL,MAAM,CAAC;AAAA,UACT;AAAA,QAAA,CACD;AAAA,IAEL;AAAA,EAAA,CACD,GAEM,EAAE,OAAAlB,GAAO,QAAAQ,GAAQ,aAAAI;AAC1B;ACpSO,SAASY,GACdC,GACkC;AAC3B,SAAA,MAAM,QAAQA,CAAU;AACjC;AAEgB,SAAAC,GAAkCR,GAAcC,GAAY;AAC1E,SAAOhF,EAAa+E,GAAM,SAAiBS,GAAM;AACxC,WAAA;AAAA,MACL,SAASA;AAAA,IAAA;AAAA,EACX,CACD,EAAER,CAAO;AACZ;"}