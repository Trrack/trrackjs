"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const d=require("@reduxjs/toolkit"),w=require("@trrack/core"),l=d.createAction("NO_OP"),m=Symbol("label"),O=Symbol("do_undo_action_creators"),b=Symbol("trrackable"),L=Symbol("events"),_=Symbol("action_name_type_map"),v=Symbol("async_thunks");function x(e){const r={};return Object.entries(e.actions).forEach(([n,t])=>{r[n]=t.type}),r}function I(e,r,n){const t={};return n.forEach(a=>{const c=a.typePrefix,o=r[c];if(!o){t[c]=()=>c;return}if(typeof o=="string"){t[c]=()=>o;return}throw typeof o=="function"&&(t[c]=o),new Error(`Error creating label generator for ${c.toString()}`)}),Object.entries(e.actions).forEach(([a,c])=>{const o=r[a];if(!o){t[c.type]=()=>c.type;return}if(typeof o=="string"){t[c.type]=()=>o;return}if(typeof o=="function"){t[c.type]=o;return}throw new Error(`Error creating label generator for ${a.toString()}: ${c.type}`)}),t}function B(e,r,n){const t={};return n.forEach(a=>{const c=a.typePrefix,o=r[c];o?t[c]=o:t[c]=c}),Object.entries(e.actions).forEach(([a,c])=>{const o=r[a];o?t[c.type]=o:t[c.type]=c.type}),t}function H(e,r,n){const t={};return n.forEach(a=>{const c=a.typePrefix,o=r[c];if(o){const f=y=>{const{do:p,undo:u}=o(y);return{do:p||l(),undo:u}};t[c]=f}else{const f=()=>({do:l(),undo:l()});t[c]=f}}),Object.entries(e.actions).forEach(([a,c])=>{const o=r[a];o?t[c.type]=f=>{const{do:y,undo:p}=o(f);return{do:y||l(),undo:p}}:t[c.type]=()=>({do:l(),undo:l()})}),t}function K(e){const r=d.createSlice(e),n=x(r),t=I(r,e.labels||{},e.asyncThunks||[]),a=B(r,e.reducerEventTypes||{},e.asyncThunks||[]),c=H(r,e.doUndoActionCreators||{},e.asyncThunks||[]);return{...r,[m]:t,[L]:a,[O]:c,[b]:!0,[_]:n,[v]:e.asyncThunks||[]}}function A(e){return b?b in e:!1}const Y={current:null},U=d.createSlice({name:"trrack",initialState:Y,reducers:{changeCurrent:(e,r)=>({current:r.payload})}}),{changeCurrent:R}=U.actions;function M(e){return d.configureStore({reducer:U.reducer,preloadedState:e})}const C=d.createAction("traverse",function(r){return{payload:r}});function G(e){return e.type===C.type}function $(e){return function(r,n){return G(n)?e(n.payload,n):e(r,n)}}function q(e){return e.reduce((r,n)=>A(n)?{...r,...n[m]}:r,{})}function z(e){return e.reduce((r,n)=>A(n)?{...r,...n[O]}:r,{})}function F(e){return e.reduce((r,n)=>A(n)?{...r,...n[_]}:r,{})}function V(e){return e.reduce((r,n)=>{if(A(n)){const t={};return n[v].forEach(a=>{t[a.typePrefix]=a,t[a.fulfilled.type]=a}),{...r,...t}}return r},{})}function J(e){return e.reduce((r,n)=>A(n)?[...r,...Object.values(n.actions)]:r,[])}function Q(e){const r=d.createListenerMiddleware(),n=e.reducer,t=d.configureStore({...e,reducer:$(typeof n=="function"?n:d.combineReducers(n)),middleware(s){const i=e.middleware;return i?typeof i=="function"?[...i(s),r.middleware]:[...i,r.middleware]:s().prepend(r.middleware)}}),a=r.startListening,c=q(e.slices),o=z(e.slices),f=F(e.slices),y=V(e.slices),p=J(e.slices),u=w.initializeTrrack({initialState:t.getState(),registry:w.Registry.create()});let S="active";Object.values(y).forEach(s=>{u.registry.has(s.typePrefix)||u.registry.register(s.typePrefix,i=>(S="paused",t.dispatch(s(i)).then(()=>S="active")))}),e.slices.forEach(s=>{Object.values(s.actions).forEach(i=>{u.registry.register(i.type,T=>t.dispatch(T))})});const N=M({current:u.current.id});return u.currentChange(()=>{S="paused",t.dispatch(C(u.getState())),N.dispatch(R(u.current.id)),S="active"}),a({predicate(s){return u.isTraversing||S==="paused"?!1:d.isAsyncThunkAction(s)?d.isFulfilled(s):d.isAnyOf(p[0],...p)(s)},effect(s,i){const T=d.isFulfilled(s),g=T?y[s.type].typePrefix:s.type,j=s.payload,D=c[g],P=D(j),E=o[g]({action:s,currentState:i.getState(),previousState:i.getOriginalState()});if(!l.match(E.undo)){const h=E.undo,k=l.match(E.do)?s:E.do;u.record({label:P,state:i.getState(),eventType:f[g],sideEffects:{do:[{type:T?g:k.type,payload:T?k.payload:k}],undo:[{type:h.type,payload:T?h.payload:h}]},onlySideEffects:!0})}else u.record({label:P,state:i.getState(),eventType:f[g],sideEffects:{do:[],undo:[]}})}}),{store:t,trrack:u,trrackStore:N}}function W(e){return Array.isArray(e)}function X(e,r){return d.createAction(e,function(t){return{payload:t}})(r)}exports.ACTION_NAME_TYPE_MAP=_;exports.ASYNC_THUNKS=v;exports.DO_UNDO_ACTION_CREATORS=O;exports.EVENTS=L;exports.LABELS=m;exports.NO_OP_ACTION=l;exports.TRRACKABLE=b;exports.asyncDoUndoActionCreatorHelper=X;exports.changeCurrent=R;exports.configureTrrackableStore=Q;exports.createTrrackableSlice=K;exports.getTrrackStore=M;exports.isMiddlewareArray=W;exports.isSliceTrrackable=A;exports.trrackTraverseAction=C;
//# sourceMappingURL=index.js.map
