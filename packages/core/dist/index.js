"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const j=require("@reduxjs/toolkit");function Ce(){const e=new Map;return{listen(t,r){return e.has(t)||e.set(t,[]),e.get(t).push(r),()=>{e.set(t,(e.get(t)||[]).filter(n=>n!==r))}},fire(t,r){const n=e.get(t);n&&n.forEach(o=>o(r))}}}let B;const Ge=new Uint8Array(16);function Qe(){if(!B&&(B=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!B))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return B(Ge)}const w=[];for(let e=0;e<256;++e)w.push((e+256).toString(16).slice(1));function qe(e,t=0){return w[e[t+0]]+w[e[t+1]]+w[e[t+2]]+w[e[t+3]]+"-"+w[e[t+4]]+w[e[t+5]]+"-"+w[e[t+6]]+w[e[t+7]]+"-"+w[e[t+8]]+w[e[t+9]]+"-"+w[e[t+10]]+w[e[t+11]]+w[e[t+12]]+w[e[t+13]]+w[e[t+14]]+w[e[t+15]]}const Ye=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Pe={randomUUID:Ye};function Te(e,t,r){if(Pe.randomUUID&&!t&&!e)return Pe.randomUUID();e=e||{};const n=e.random||(e.rng||Qe)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(let o=0;o<16;++o)t[r+o]=n[o];return t}return qe(n)}class P{static get(){let t=Te();for(;this.ids.has(t);)t=Te();return this.ids.set(t,!0),t}}P.ids=new Map;function N(e){return"parent"in e}function Xe(e){return!N(e)}function xe(e){const{label:t=void 0,state:r,initialArtifact:n,initialMetadata:o}=e,a={annotation:[],bookmark:[]},u=Object.keys(o||{}).reduce((f,s)=>(f[s]=[],o&&o[s]&&f[s].push({type:s,id:P.get(),val:o[s],createdOn:Date.now()}),f),a),l=n?[{id:P.get(),createdOn:Date.now(),val:n}]:[];return{id:P.get(),label:t||"Root",event:"Root",children:[],level:0,createdOn:Date.now(),meta:u,artifacts:l,state:{type:"checkpoint",val:r}}}function ze({parent:e,state:t,label:r,sideEffects:n={do:[],undo:[]},initialMetadata:o,initialArtifact:a,event:u}){const l={annotation:[],bookmark:[]},f=Object.keys(o||{}).reduce((i,c)=>(i[c]=[],o&&o[c]&&i[c].push({type:c,id:P.get(),val:o[c],createdOn:Date.now()}),i),l),s=a?[{id:P.get(),createdOn:Date.now(),val:a}]:[];return{id:P.get(),label:r,event:u,children:[],parent:e.id,createdOn:Date.now(),meta:f,artifacts:s,sideEffects:n,state:t,level:e.level+1}}function g(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if({}.NODE_ENV!=="production"){var o=it[e],a=o?typeof o=="function"?o.apply(null,r):o:"unknown error nr: "+e;throw Error("[Immer] "+a)}throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(u){return"'"+u+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function U(e){return!!e&&!!e[b]}function S(e){var t;return!!e&&(function(r){if(!r||typeof r!="object")return!1;var n=Object.getPrototypeOf(r);if(n===null)return!0;var o=Object.hasOwnProperty.call(n,"constructor")&&n.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===ut}(e)||Array.isArray(e)||!!e[J]||!!(!((t=e.constructor)===null||t===void 0)&&t[J])||Z(e)||V(e))}function z(e,t,r){r===void 0&&(r=!1),R(e)===0?(r?Object.keys:Ae)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,o){return t(o,n,e)})}function R(e){var t=e[b];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Z(e)?2:V(e)?3:0}function K(e,t){return R(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function $(e,t){return R(e)===2?e.get(t):e[t]}function Fe(e,t,r){var n=R(e);n===2?e.set(t,r):n===3?e.add(r):e[t]=r}function Ze(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Z(e){return ot&&e instanceof Map}function V(e){return at&&e instanceof Set}function I(e){return e.o||e.t}function ye(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=ct(e);delete t[b];for(var r=Ae(t),n=0;n<r.length;n++){var o=r[n],a=t[o];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(t[o]={configurable:!0,writable:!0,enumerable:a.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function ge(e,t){return t===void 0&&(t=!1),me(e)||U(e)||!S(e)||(R(e)>1&&(e.set=e.add=e.clear=e.delete=Ve),Object.freeze(e),t&&z(e,function(r,n){return ge(n,!0)},!0)),e}function Ve(){g(2)}function me(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function T(e){var t=se[e];return t||g(18,e),t}function et(e,t){se[e]||(se[e]=t)}function Se(){return{}.NODE_ENV==="production"||F||g(0),F}function re(e,t){t&&(T("Patches"),e.u=[],e.s=[],e.v=t)}function G(e){ie(e),e.p.forEach(tt),e.p=null}function ie(e){e===F&&(F=e.l)}function Re(e){return F={p:[],l:F,h:e,m:!0,_:0}}function tt(e){var t=e[b];t.i===0||t.i===1?t.j():t.g=!0}function ne(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.O||T("ES5").S(t,e,n),n?(r[b].P&&(G(t),g(4)),S(e)&&(e=Q(t,e),t.l||q(t,e)),t.u&&T("Patches").M(r[b].t,e,t.u,t.s)):e=Q(t,r,[]),G(t),t.u&&t.v(t.u,t.s),e!==Oe?e:void 0}function Q(e,t,r){if(me(t))return t;var n=t[b];if(!n)return z(t,function(l,f){return De(e,n,t,l,f,r)},!0),t;if(n.A!==e)return t;if(!n.P)return q(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=n.i===4||n.i===5?n.o=ye(n.k):n.o,a=o,u=!1;n.i===3&&(a=new Set(o),o.clear(),u=!0),z(a,function(l,f){return De(e,n,o,l,f,r,u)}),q(e,o,!1),r&&e.u&&T("Patches").N(n,r,e.u,e.s)}return n.o}function De(e,t,r,n,o,a,u){if({}.NODE_ENV!=="production"&&o===r&&g(5),U(o)){var l=Q(e,o,a&&t&&t.i!==3&&!K(t.R,n)?a.concat(n):void 0);if(Fe(r,n,l),!U(l))return;e.m=!1}else u&&r.add(o);if(S(o)&&!me(o)){if(!e.h.D&&e._<1)return;Q(e,o),t&&t.A.l||q(e,o)}}function q(e,t,r){r===void 0&&(r=!1),!e.l&&e.h.D&&e.m&&ge(t,r)}function oe(e,t){var r=e[b];return(r?I(r):e)[t]}function Ie(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function ue(e){e.P||(e.P=!0,e.l&&ue(e.l))}function ae(e){e.o||(e.o=ye(e.t))}function ce(e,t,r){var n=Z(t)?T("MapSet").F(t,r):V(t)?T("MapSet").T(t,r):e.O?function(o,a){var u=Array.isArray(o),l={i:u?1:0,A:a?a.A:Se(),P:!1,I:!1,R:{},l:a,t:o,k:null,o:null,j:null,C:!1},f=l,s=fe;u&&(f=[l],s=k);var i=Proxy.revocable(f,s),c=i.revoke,p=i.proxy;return l.k=p,l.j=c,p}(t,r):T("ES5").J(t,r);return(r?r.A:Se()).p.push(n),n}function rt(e){return U(e)||g(22,e),function t(r){if(!S(r))return r;var n,o=r[b],a=R(r);if(o){if(!o.P&&(o.i<4||!T("ES5").K(o)))return o.t;o.I=!0,n=Le(r,a),o.I=!1}else n=Le(r,a);return z(n,function(u,l){o&&$(o.t,u)===l||Fe(n,u,t(l))}),a===3?new Set(n):n}(e)}function Le(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return ye(e)}function nt(){function e(n){if(!S(n))return n;if(Array.isArray(n))return n.map(e);if(Z(n))return new Map(Array.from(n.entries()).map(function(u){return[u[0],e(u[1])]}));if(V(n))return new Set(Array.from(n).map(e));var o=Object.create(Object.getPrototypeOf(n));for(var a in n)o[a]=e(n[a]);return K(n,J)&&(o[J]=n[J]),o}function t(n){return U(n)?e(n):n}var r="add";et("Patches",{$:function(n,o){return o.forEach(function(a){for(var u=a.path,l=a.op,f=n,s=0;s<u.length-1;s++){var i=R(f),c=u[s];typeof c!="string"&&typeof c!="number"&&(c=""+c),i!==0&&i!==1||c!=="__proto__"&&c!=="constructor"||g(24),typeof f=="function"&&c==="prototype"&&g(24),typeof(f=$(f,c))!="object"&&g(15,u.join("/"))}var p=R(f),d=e(a.value),h=u[u.length-1];switch(l){case"replace":switch(p){case 2:return f.set(h,d);case 3:g(16);default:return f[h]=d}case r:switch(p){case 1:return h==="-"?f.push(d):f.splice(h,0,d);case 2:return f.set(h,d);case 3:return f.add(d);default:return f[h]=d}case"remove":switch(p){case 1:return f.splice(h,1);case 2:return f.delete(h);case 3:return f.delete(a.value);default:return delete f[h]}default:g(17,l)}}),n},N:function(n,o,a,u){switch(n.i){case 0:case 4:case 2:return function(l,f,s,i){var c=l.t,p=l.o;z(l.R,function(d,h){var v=$(c,d),m=$(p,d),A=h?K(c,d)?"replace":r:"remove";if(v!==m||A!=="replace"){var O=f.concat(d);s.push(A==="remove"?{op:A,path:O}:{op:A,path:O,value:m}),i.push(A===r?{op:"remove",path:O}:A==="remove"?{op:r,path:O,value:t(v)}:{op:"replace",path:O,value:t(v)})}})}(n,o,a,u);case 5:case 1:return function(l,f,s,i){var c=l.t,p=l.R,d=l.o;if(d.length<c.length){var h=[d,c];c=h[0],d=h[1];var v=[i,s];s=v[0],i=v[1]}for(var m=0;m<c.length;m++)if(p[m]&&d[m]!==c[m]){var A=f.concat([m]);s.push({op:"replace",path:A,value:t(d[m])}),i.push({op:"replace",path:A,value:t(c[m])})}for(var O=c.length;O<d.length;O++){var D=f.concat([O]);s.push({op:r,path:D,value:t(d[O])})}c.length<d.length&&i.push({op:"replace",path:f.concat(["length"]),value:c.length})}(n,o,a,u);case 3:return function(l,f,s,i){var c=l.t,p=l.o,d=0;c.forEach(function(h){if(!p.has(h)){var v=f.concat([d]);s.push({op:"remove",path:v,value:h}),i.unshift({op:r,path:v,value:h})}d++}),d=0,p.forEach(function(h){if(!c.has(h)){var v=f.concat([d]);s.push({op:r,path:v,value:h}),i.unshift({op:"remove",path:v,value:h})}d++})}(n,o,a,u)}},M:function(n,o,a,u){a.push({op:"replace",path:[],value:o===Oe?void 0:o}),u.push({op:"replace",path:[],value:n})}})}var je,F,we=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",ot=typeof Map<"u",at=typeof Set<"u",Me=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Oe=we?Symbol.for("immer-nothing"):((je={})["immer-nothing"]=!0,je),J=we?Symbol.for("immer-draftable"):"__$immer_draftable",b=we?Symbol.for("immer-state"):"__$immer_state",it={0:"Illegal state",1:"Immer drafts cannot have computed properties",2:"This object has been frozen and should not be mutated",3:function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},4:"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.",5:"Immer forbids circular references",6:"The first or second argument to `produce` must be a function",7:"The third argument to `produce` must be a function or undefined",8:"First argument to `createDraft` must be a plain object, an array, or an immerable object",9:"First argument to `finishDraft` must be a draft returned by `createDraft`",10:"The given draft is already finalized",11:"Object.defineProperty() cannot be used on an Immer draft",12:"Object.setPrototypeOf() cannot be used on an Immer draft",13:"Immer only supports deleting array indices",14:"Immer only supports setting array indices and the 'length' property",15:function(e){return"Cannot apply patch, path doesn't resolve: "+e},16:'Sets cannot have "replace" patches.',17:function(e){return"Unsupported patch operation: "+e},18:function(e){return"The plugin for '"+e+"' has not been loaded into Immer. To enable the plugin, import and call `enable"+e+"()` when initializing your application."},20:"Cannot use proxies if Proxy, Proxy.revocable or Reflect are not available",21:function(e){return"produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '"+e+"'"},22:function(e){return"'current' expects a draft, got: "+e},23:function(e){return"'original' expects a draft, got: "+e},24:"Patching reserved attributes like __proto__, prototype and constructor is not allowed"},ut=""+Object.prototype.constructor,Ae=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,ct=Object.getOwnPropertyDescriptors||function(e){var t={};return Ae(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},se={},fe={get:function(e,t){if(t===b)return e;var r=I(e);if(!K(r,t))return function(o,a,u){var l,f=Ie(a,u);return f?"value"in f?f.value:(l=f.get)===null||l===void 0?void 0:l.call(o.k):void 0}(e,r,t);var n=r[t];return e.I||!S(n)?n:n===oe(e.t,t)?(ae(e),e.o[t]=ce(e.A.h,n,e)):n},has:function(e,t){return t in I(e)},ownKeys:function(e){return Reflect.ownKeys(I(e))},set:function(e,t,r){var n=Ie(I(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var o=oe(I(e),t),a=o==null?void 0:o[b];if(a&&a.t===r)return e.o[t]=r,e.R[t]=!1,!0;if(Ze(r,o)&&(r!==void 0||K(e.t,t)))return!0;ae(e),ue(e)}return e.o[t]===r&&(r!==void 0||t in e.o)||Number.isNaN(r)&&Number.isNaN(e.o[t])||(e.o[t]=r,e.R[t]=!0),!0},deleteProperty:function(e,t){return oe(e.t,t)!==void 0||t in e.t?(e.R[t]=!1,ae(e),ue(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=I(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){g(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){g(12)}},k={};z(fe,function(e,t){k[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),k.deleteProperty=function(e,t){return{}.NODE_ENV!=="production"&&isNaN(parseInt(t))&&g(13),k.set.call(this,e,t,void 0)},k.set=function(e,t,r){return{}.NODE_ENV!=="production"&&t!=="length"&&isNaN(parseInt(t))&&g(14),fe.set.call(this,e[0],t,r,e[0])};var st=function(){function e(r){var n=this;this.O=Me,this.D=!0,this.produce=function(o,a,u){if(typeof o=="function"&&typeof a!="function"){var l=a;a=o;var f=n;return function(v){var m=this;v===void 0&&(v=l);for(var A=arguments.length,O=Array(A>1?A-1:0),D=1;D<A;D++)O[D-1]=arguments[D];return f.produce(v,function(te){var Ne;return(Ne=a).call.apply(Ne,[m,te].concat(O))})}}var s;if(typeof a!="function"&&g(6),u!==void 0&&typeof u!="function"&&g(7),S(o)){var i=Re(n),c=ce(n,o,void 0),p=!0;try{s=a(c),p=!1}finally{p?G(i):ie(i)}return typeof Promise<"u"&&s instanceof Promise?s.then(function(v){return re(i,u),ne(v,i)},function(v){throw G(i),v}):(re(i,u),ne(s,i))}if(!o||typeof o!="object"){if((s=a(o))===void 0&&(s=o),s===Oe&&(s=void 0),n.D&&ge(s,!0),u){var d=[],h=[];T("Patches").M(o,s,d,h),u(d,h)}return s}g(21,o)},this.produceWithPatches=function(o,a){if(typeof o=="function")return function(s){for(var i=arguments.length,c=Array(i>1?i-1:0),p=1;p<i;p++)c[p-1]=arguments[p];return n.produceWithPatches(s,function(d){return o.apply(void 0,[d].concat(c))})};var u,l,f=n.produce(o,a,function(s,i){u=s,l=i});return typeof Promise<"u"&&f instanceof Promise?f.then(function(s){return[s,u,l]}):[f,u,l]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){S(r)||g(8),U(r)&&(r=rt(r));var n=Re(this),o=ce(this,r,void 0);return o[b].C=!0,ie(n),o},t.finishDraft=function(r,n){var o=r&&r[b];({}).NODE_ENV!=="production"&&(o&&o.C||g(9),o.I&&g(10));var a=o.A;return re(a,n),ne(void 0,a)},t.setAutoFreeze=function(r){this.D=r},t.setUseProxies=function(r){r&&!Me&&g(20),this.O=r},t.applyPatches=function(r,n){var o;for(o=n.length-1;o>=0;o--){var a=n[o];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}o>-1&&(n=n.slice(o+1));var u=T("Patches").$;return U(r)?u(r,n):this.produce(r,function(l){return u(l,n)})},e}(),_=new st,ft=_.produce;_.produceWithPatches.bind(_);_.setAutoFreeze.bind(_);_.setUseProxies.bind(_);_.applyPatches.bind(_);_.createDraft.bind(_);_.finishDraft.bind(_);function lt(e,t={}){const{artifact:r=void 0,metadata:n=void 0,rootLabel:o="Root"}=t,a=xe({state:e,label:o,initialArtifact:r,initialMetadata:n}),u={nodes:{[a.id]:a},root:a.id,current:a.id};return j.createSlice({name:"provenance-graph",initialState:u,reducers:{addMetadata(f,s){const{id:i,meta:c}=s.payload,p=f.nodes[i].meta,d=Object.keys(c).reduce((h,v)=>(h[v]||(h[v]=[]),h[v].push({type:v,id:P.get(),val:c[v],createdOn:Date.now()}),h),p);f.nodes[s.payload.id].meta=d},addArtifact(f,s){f.nodes[s.payload.id].artifacts.push({id:P.get(),createdOn:Date.now(),val:s.payload.artifact})},changeCurrent(f,s){f.current=s.payload},addNode(f,{payload:s}){f.nodes[s.id]=s,f.nodes[s.parent].children.push(s.id),f.current=s.id},load(f,{payload:s}){return s}}})}function ke(e){const t=new Map,{reducer:r,actions:n,getInitialState:o}=lt(e),a=j.createListenerMiddleware();a.startListening({matcher:j.isAnyOf(n.changeCurrent,n.addNode),effect:(l,f)=>{f.cancelActiveListeners(),t.forEach(s=>{const i=j.isAnyOf(n.addNode)(l),{skipOnNew:c}=s.config;c&&i||s.func(i?"new":"traversal")})}});const u=j.configureStore({reducer:r,middleware:l=>l().prepend(a.middleware)});return{initialState:o(),get backend(){return u.getState()},get current(){return u.getState().nodes[u.getState().current]},get root(){return u.getState().nodes[u.getState().root]},currentChange(l,f){const s={id:P.get(),func:l,config:f};return t.set(s.id,s),()=>t.delete(s.id)},update:u.dispatch,...n}}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var dt=globalThis&&globalThis.__extends||function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,o){n.__proto__=o}||function(n,o){for(var a in o)o.hasOwnProperty(a)&&(n[a]=o[a])},e(t,r)};return function(t,r){e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),pt=Object.prototype.hasOwnProperty;function le(e,t){return pt.call(e,t)}function de(e){if(Array.isArray(e)){for(var t=new Array(e.length),r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(e);var n=[];for(var o in e)le(e,o)&&n.push(o);return n}function E(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function pe(e){for(var t=0,r=e.length,n;t<r;){if(n=e.charCodeAt(t),n>=48&&n<=57){t++;continue}return!1}return!0}function L(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Je(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function he(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,r=e.length;t<r;t++)if(he(e[t]))return!0}else if(typeof e=="object"){for(var n=de(e),o=n.length,a=0;a<o;a++)if(he(e[n[a]]))return!0}}return!1}function Ue(e,t){var r=[e];for(var n in t){var o=typeof t[n]=="object"?JSON.stringify(t[n],null,2):t[n];typeof o<"u"&&r.push(n+": "+o)}return r.join(`
`)}var Ke=function(e){dt(t,e);function t(r,n,o,a,u){var l=this.constructor,f=e.call(this,Ue(r,{name:n,index:o,operation:a,tree:u}))||this;return f.name=n,f.index=o,f.operation=a,f.tree=u,Object.setPrototypeOf(f,l.prototype),f.message=Ue(r,{name:n,index:o,operation:a,tree:u}),f}return t}(Error),y=Ke,ht=E,C={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var n=e[t];return delete e[t],{newDocument:r,removed:n}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:function(e,t,r){var n=Y(r,this.path);n&&(n=E(n));var o=M(r,{op:"remove",path:this.from}).removed;return M(r,{op:"add",path:this.path,value:o}),{newDocument:r,removed:n}},copy:function(e,t,r){var n=Y(r,this.from);return M(r,{op:"add",path:this.path,value:E(n)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:H(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}},vt={add:function(e,t,r){return pe(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){var n=e.splice(t,1);return{newDocument:r,removed:n[0]}},replace:function(e,t,r){var n=e[t];return e[t]=this.value,{newDocument:r,removed:n}},move:C.move,copy:C.copy,test:C.test,_get:C._get};function Y(e,t){if(t=="")return e;var r={op:"_get",path:t};return M(e,r),r.value}function M(e,t,r,n,o,a){if(r===void 0&&(r=!1),n===void 0&&(n=!0),o===void 0&&(o=!0),a===void 0&&(a=0),r&&(typeof r=="function"?r(t,0,e,t.path):X(t,0)),t.path===""){var u={newDocument:e};if(t.op==="add")return u.newDocument=t.value,u;if(t.op==="replace")return u.newDocument=t.value,u.removed=e,u;if(t.op==="move"||t.op==="copy")return u.newDocument=Y(e,t.from),t.op==="move"&&(u.removed=e),u;if(t.op==="test"){if(u.test=H(e,t.value),u.test===!1)throw new y("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return u.newDocument=e,u}else{if(t.op==="remove")return u.removed=e,u.newDocument=null,u;if(t.op==="_get")return t.value=e,u;if(r)throw new y("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,t,e);return u}}else{n||(e=E(e));var l=t.path||"",f=l.split("/"),s=e,i=1,c=f.length,p=void 0,d=void 0,h=void 0;for(typeof r=="function"?h=r:h=X;;){if(d=f[i],d&&d.indexOf("~")!=-1&&(d=Je(d)),o&&(d=="__proto__"||d=="prototype"&&i>0&&f[i-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&p===void 0&&(s[d]===void 0?p=f.slice(0,i).join("/"):i==c-1&&(p=t.path),p!==void 0&&h(t,0,e,p)),i++,Array.isArray(s)){if(d==="-")d=s.length;else{if(r&&!pe(d))throw new y("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,t,e);pe(d)&&(d=~~d)}if(i>=c){if(r&&t.op==="add"&&d>s.length)throw new y("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,t,e);var u=vt[t.op].call(t,s,d,e);if(u.test===!1)throw new y("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return u}}else if(i>=c){var u=C[t.op].call(t,s,d,e);if(u.test===!1)throw new y("Test operation failed","TEST_OPERATION_FAILED",a,t,e);return u}if(s=s[d],r&&i<c&&(!s||typeof s!="object"))throw new y("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,t,e)}}}function ee(e,t,r,n,o){if(n===void 0&&(n=!0),o===void 0&&(o=!0),r&&!Array.isArray(t))throw new y("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");n||(e=E(e));for(var a=new Array(t.length),u=0,l=t.length;u<l;u++)a[u]=M(e,t[u],r,!0,o,u),e=a[u].newDocument;return a.newDocument=e,a}function yt(e,t,r){var n=M(e,t);if(n.test===!1)throw new y("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return n.newDocument}function X(e,t,r,n){if(typeof e!="object"||e===null||Array.isArray(e))throw new y("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(C[e.op]){if(typeof e.path!="string")throw new y("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new y('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new y("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new y("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);if((e.op==="add"||e.op==="replace"||e.op==="test")&&he(e.value))throw new y("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);if(r){if(e.op=="add"){var o=e.path.split("/").length,a=n.split("/").length;if(o!==a+1&&o!==a)throw new y("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==n)throw new y("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if(e.op==="move"||e.op==="copy"){var u={op:"_get",path:e.from,value:void 0},l=He([u],r);if(l&&l.name==="OPERATION_PATH_UNRESOLVABLE")throw new y("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new y("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function He(e,t,r){try{if(!Array.isArray(e))throw new y("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)ee(E(t),E(e),r||!0);else{r=r||X;for(var n=0;n<e.length;n++)r(e[n],n,t,void 0)}}catch(o){if(o instanceof y)return o;throw o}}function H(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=Array.isArray(e),n=Array.isArray(t),o,a,u;if(r&&n){if(a=e.length,a!=t.length)return!1;for(o=a;o--!==0;)if(!H(e[o],t[o]))return!1;return!0}if(r!=n)return!1;var l=Object.keys(e);if(a=l.length,a!==Object.keys(t).length)return!1;for(o=a;o--!==0;)if(!t.hasOwnProperty(l[o]))return!1;for(o=a;o--!==0;)if(u=l[o],!H(e[u],t[u]))return!1;return!0}return e!==e&&t!==t}const gt=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:y,_areEquals:H,applyOperation:M,applyPatch:ee,applyReducer:yt,deepClone:ht,getValueByPointer:Y,validate:He,validator:X},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Ee=new WeakMap,mt=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),wt=function(){function e(t,r){this.callback=t,this.observer=r}return e}();function Ot(e){return Ee.get(e)}function At(e,t){return e.observers.get(t)}function Et(e,t){e.observers.delete(t.callback)}function bt(e,t){t.unobserve()}function _t(e,t){var r=[],n,o=Ot(e);if(!o)o=new mt(e),Ee.set(e,o);else{var a=At(o,t);n=a&&a.observer}if(n)return n;if(n={},o.value=E(e),t){n.callback=t,n.next=null;var u=function(){ve(n)},l=function(){clearTimeout(n.next),n.next=setTimeout(u)};typeof window<"u"&&(window.addEventListener("mouseup",l),window.addEventListener("keyup",l),window.addEventListener("mousedown",l),window.addEventListener("keydown",l),window.addEventListener("change",l))}return n.patches=r,n.object=e,n.unobserve=function(){ve(n),clearTimeout(n.next),Et(o,n),typeof window<"u"&&(window.removeEventListener("mouseup",l),window.removeEventListener("keyup",l),window.removeEventListener("mousedown",l),window.removeEventListener("keydown",l),window.removeEventListener("change",l))},o.observers.set(t,new wt(t,n)),n}function ve(e,t){t===void 0&&(t=!1);var r=Ee.get(e.object);be(r.value,e.object,e.patches,"",t),e.patches.length&&ee(r.value,e.patches);var n=e.patches;return n.length>0&&(e.patches=[],e.callback&&e.callback(n)),n}function be(e,t,r,n,o){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var a=de(t),u=de(e),l=!1,f=u.length-1;f>=0;f--){var s=u[f],i=e[s];if(le(t,s)&&!(t[s]===void 0&&i!==void 0&&Array.isArray(t)===!1)){var c=t[s];typeof i=="object"&&i!=null&&typeof c=="object"&&c!=null&&Array.isArray(i)===Array.isArray(c)?be(i,c,r,n+"/"+L(s),o):i!==c&&(o&&r.push({op:"test",path:n+"/"+L(s),value:E(i)}),r.push({op:"replace",path:n+"/"+L(s),value:E(c)}))}else Array.isArray(e)===Array.isArray(t)?(o&&r.push({op:"test",path:n+"/"+L(s),value:E(i)}),r.push({op:"remove",path:n+"/"+L(s)}),l=!0):(o&&r.push({op:"test",path:n,value:e}),r.push({op:"replace",path:n,value:t}))}if(!(!l&&a.length==u.length))for(var f=0;f<a.length;f++){var s=a[f];!le(e,s)&&t[s]!==void 0&&r.push({op:"add",path:n+"/"+L(s),value:E(t[s])})}}}function Be(e,t,r){r===void 0&&(r=!1);var n=[];return be(e,t,n,"",r),n}const Nt=Object.freeze(Object.defineProperty({__proto__:null,compare:Be,generate:ve,observe:_t,unobserve:bt},Symbol.toStringTag,{value:"Module"}));Object.assign({},gt,Nt,{JsonPatchError:Ke,deepClone:E,escapePathComponent:L,unescapePathComponent:Je});var x=(e=>(e.TRAVERSAL_START="Traversal_Start",e.TRAVERSAL_END="Traversal_End",e))(x||{});function W(e,t){const r=e.state;if(r.type==="checkpoint")return r.val;const{checkpointRef:n}=r,o=t[n],a=$e(o,e,t);a.shift();const u=a.map(s=>t[s]).map(s=>s.state.val).reduce((s,i)=>[...s,...i],[]),l=W(o,t);return ee(l,E(u),!0,!1).newDocument}function Pt(e,t){const r=Object.keys(e).length;return new Set(t.map(o=>o.path.split("/")[0])).size<r/2?"patch":"checkpoint"}function Tt({registry:e,initialState:t}){let r=!1;const n=Ce(),o=ke(t);function a(i){return o.backend.nodes[i]}n.listen(x.TRAVERSAL_START,()=>{r=!0}),n.listen(x.TRAVERSAL_END,()=>{r=!1});const u={add(i,c=o.current.id){o.update(o.addMetadata({id:c,meta:i}))},latestOfType(i,c=o.current.id){var p;return(p=o.backend.nodes[c].meta[i])==null?void 0:p.at(-1)},allOfType(i,c=o.current.id){return o.backend.nodes[c].meta[i]},latest(i=o.current.id){const c=o.backend.nodes[i].meta,p=Object.keys(c).reduce((d,h)=>{const v=c[h].at(-1);return v&&(d[h]=v),d},{});return Object.keys(p).length>0?p:void 0},all(i=o.current.id){return o.backend.nodes[i].meta},types(i=o.current.id){return Object.keys(o.backend.nodes[i].meta)}},l={add(i,c=o.current.id){o.update(o.addArtifact({id:c,artifact:i}))},latest(i=o.current.id){return o.backend.nodes[i].artifacts.at(-1)},all(i=o.current.id){return o.backend.nodes[i].artifacts}},f={add(i,c=o.current.id){u.add({annotation:i},c)},latest(i=o.current.id){var c;return(c=u.latestOfType("annotation",i))==null?void 0:c.val},all(i=o.current.id){var c;return(c=u.allOfType("annotation",i))==null?void 0:c.map(p=>p.val)}},s={add(i=o.current.id){u.add({bookmark:!0},i)},remove(i=o.current.id){u.add({bookmark:!1},i)},is(i=o.current.id){var c;return!!((c=u.latestOfType("bookmark",i))!=null&&c.val)},toggle(i=o.current.id){s.is(i)?s.remove(i):s.add(i)}};return{registry:e,get isTraversing(){return r},getState(i=o.current){return W(i,o.backend.nodes)},graph:o,get current(){return o.current},get root(){return o.root},record({label:i,state:c,sideEffects:p,eventType:d,onlySideEffects:h=!1}){let v=null,m=null;const A=W(this.current,this.graph.backend.nodes);if(h)m={type:"checkpoint",val:c};else{const O=Be(A,c);if(Pt(c,O)==="checkpoint")m={type:"checkpoint",val:c};else{const te=this.current.state.type==="checkpoint"?this.current.id:this.current.state.checkpointRef;m={type:"patch",val:O,checkpointRef:te}}}if(!m)throw new Error(`Could not calculate new state. Previous state is: ${JSON.stringify(this.current.state,null,2)}`);if(v=ze({label:i,state:m,parent:this.current,sideEffects:p,event:d}),!v)throw new Error("State Node creation failed!");o.update(o.addNode(v))},async apply(i,c){const p=e.get(c.type),d=W(this.current,this.graph.backend.nodes);if(p.config.hasSideEffects){const{do:h=c,undo:v}=p.func(c.payload);this.record({label:i,state:d,sideEffects:{do:[h],undo:[v]},eventType:p.config.eventType})}else{const h=p.func(d,c.payload);this.record({label:i,state:h,sideEffects:{do:[],undo:[]},eventType:p.config.eventType})}},async to(i){n.fire(x.TRAVERSAL_START);const c=$e(o.current,o.backend.nodes[i],o.backend.nodes),p=[];for(let d=0;d<c.length-1;++d){const h=a(c[d]),v=a(c[d+1]);Rt(h,v)?N(h)&&p.push(...h.sideEffects.undo):N(v)&&p.push(...v.sideEffects.do)}for(const d of p){const h=e.get(d.type).func;await h(d.payload)}o.update(o.changeCurrent(i)),n.fire(x.TRAVERSAL_END)},undo(){const{current:i}=o;return N(i)?this.to(i.parent):Promise.resolve(console.warn("Already at root!"))},redo(i="latest"){const{current:c}=o;return c.children.length>0?this.to(c.children[i==="oldest"?0:c.children.length-1]):Promise.resolve(console.warn("Already at latest in this branch!"))},currentChange(i,c=!1){return o.currentChange(i,{skipOnNew:c})},done(){console.log("Setup later for URL sharing.")},tree(){return We(o.root,o.backend.nodes)},on(i,c){n.listen(i,c)},export(){return JSON.stringify(o.backend)},exportObject(){return JSON.parse(JSON.stringify(o.backend))},import(i){const c=JSON.parse(i),p=c.current;c.current=c.root,o.update(o.load(c)),this.to(p)},importObject(i){const c=i.current;i.current=i.root,o.update(o.load(i)),this.to(c)},metadata:u,artifact:l,annotations:f,bookmarks:s}}function St(e,t,r){let[n,o]=[e,t];n.level>o.level&&([n,o]=[o,n]);let a=o.level-n.level;for(;N(o)&&a!==0;)o=r[o.parent],a-=1;if(n.id===o.id)return n.id;for(;n.id!==o.id;)N(n)&&(n=r[n.parent]),N(o)&&(o=r[o.parent]);return n.id}function $e(e,t,r){const n=St(e,t,r),o=r[n],a=[],u=[];let[l,f]=[e,t];for(;l.id!==o.id;)a.push(l),N(l)&&(l=r[l.parent]);for(a.push(l);f.id!==o.id;)u.push(f),N(f)&&(f=r[f.parent]);const s=u.reverse();return[...a,...s].map(i=>i.id)}function Rt(e,t){if(N(e)&&e.parent===t.id)return!0;if(N(t)&&t.parent===e.id)return!1;throw new Error("Incorrect use of function. Nodes are not connected to each other.")}function We(e,t){return{...e,children:e.children.map(r=>We(t[r],t)),name:`${e.label}`}}nt();function Dt(e){return e.length===2?ft(e):e}class _e{static create(){return new _e}constructor(){this.registry=new Map}has(t){return this.registry.has(t)}register(t,r,n){const o=r.length===2;if(r.length>2)throw new Error("Incorrect action function signature. Action function can only have two arguments at most!");if(this.has(t))throw new Error(`Already registered: ${t}`);const{label:a=t,eventType:u=t}=n||{};return this.registry.set(t,{func:Dt(r),config:{hasSideEffects:!o,label:typeof a=="string"?()=>a:a,eventType:u}}),j.createAction(t)}get(t){const r=this.registry.get(t);if(!r)throw new Error(`Not registered: ${t}`);return r}}Object.defineProperty(exports,"createAction",{enumerable:!0,get:()=>j.createAction});exports.ID=P;exports.Registry=_e;exports.TrrackEvents=x;exports.createRootNode=xe;exports.createStateNode=ze;exports.initEventManager=Ce;exports.initializeProvenanceGraph=ke;exports.initializeTrrack=Tt;exports.isRootNode=Xe;exports.isStateNode=N;
//# sourceMappingURL=index.js.map
